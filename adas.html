<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRO CHAT - MASTER ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        if (sessionStorage.getItem("vault_access") !== "vault1") { window.location.href = "admin.html"; }
    </script>
    <style>
        :root {
            --bg: #020617;
            --card: #0f172a;
            --primary: #3b82f6;
            --danger: #ef4444;
            --text: #f8fafc;
        }
        body { 
            background: var(--bg); color: var(--text); 
            font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 20px;
        }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #1e293b; padding-bottom: 20px; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .section { background: var(--card); border-radius: 16px; padding: 20px; border: 1px solid #1e293b; }
        h2 { margin-top: 0; color: var(--primary); font-size: 20px; display: flex; align-items: center; gap: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; font-size: 12px; color: #64748b; padding: 10px; border-bottom: 1px solid #1e293b; }
        td { padding: 12px 10px; font-size: 14px; border-bottom: 1px solid #1e293b; }
        
        .btn-del { 
            background: rgba(239, 68, 68, 0.1); color: var(--danger); 
            border: 1px solid var(--danger); padding: 5px 10px; 
            border-radius: 6px; cursor: pointer; font-size: 11px;
        }
        .btn-del:hover { background: var(--danger); color: white; }
        
        .stat-card { background: var(--primary); color: white; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
        
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1 style="margin:0">Developer Control Panel</h1>
            <p style="color:#64748b; margin:5px 0 0 0;">Managing: my-chat-app-50074</p>
        </div>
        <div id="total-users" class="stat-card">Users: 0</div>
    </div>

    <div class="grid">
        <div class="section">
            <h2>ðŸ‘¥ Registered Users</h2>
            <table>
                <thead>
                    <tr>
                        <th>UID</th>
                        <th>NAME</th>
                        <th>PASSWORD</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody id="user-table"></tbody>
            </table>
        </div>

        <div class="section">
            <h2>ðŸ’¬ Active Groups</h2>
            <table>
                <thead>
                    <tr>
                        <th>CODE</th>
                        <th>NAME</th>
                        <th>OWNER ID</th>
                        <th>ACTION</th>
                    </tr>
                </thead>
                <tbody id="group-table"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYwds3VZWOBl3dq9cXBliqLkXW8P2n4XQ",
            authDomain: "my-chat-app-50074.firebaseapp.com",
            databaseURL: "https://my-chat-app-50074-default-rtdb.firebaseio.com",
            projectId: "my-chat-app-50074",
            storageBucket: "my-chat-app-50074.firebasestorage.app",
            messagingSenderId: "40034921623",
            appId: "1:40034921623:web:875f6c7a87c9b6bef54dd2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- LOAD USERS ---
        onValue(ref(db, 'users'), (snapshot) => {
            const data = snapshot.val();
            const table = document.getElementById('user-table');
            table.innerHTML = "";
            let count = 0;

            if(data) {
                Object.entries(data).forEach(([uid, info]) => {
                    count++;
                    const row = `
                        <tr>
                            <td style="font-family:monospace">${uid}</td>
                            <td><b>${info.name}</b></td>
                            <td style="color:#eab308">${info.pass}</td>
                            <td><button class="btn-del" onclick="deleteUser('${uid}')">DELETE</button></td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });
            }
            document.getElementById('total-users').innerText = "Total Users: " + count;
        });

        // --- LOAD GROUPS ---
        onValue(ref(db, 'groups_meta'), (snapshot) => {
            const data = snapshot.val();
            const table = document.getElementById('group-table');
            table.innerHTML = "";

            if(data) {
                Object.entries(data).forEach(([gid, info]) => {
                    const row = `
                        <tr>
                            <td style="font-family:monospace">${gid}</td>
                            <td><b>${info.name}</b></td>
                            <td>${info.owner}</td>
                            <td><button class="btn-del" onclick="deleteGroup('${gid}')">NUKE</button></td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });
            }
        });

        // --- ACTIONS ---
        window.deleteUser = (uid) => {
            if(confirm("Kick this user out of the entire database?")) {
                remove(ref(db, 'users/' + uid));
            }
        };

        window.deleteGroup = (gid) => {
            if(confirm("Delete this group and all its messages?")) {
                remove(ref(db, 'groups_meta/' + gid));
                remove(ref(db, 'messages/' + gid));
            }
        };
    </script>
</body>
</html>