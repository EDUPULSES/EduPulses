<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault | Minimalist Editor</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        if (sessionStorage.getItem("vault_access") !== "vault1") { window.location.href = "admin.html"; }
    </script>

    <style>
        :root { --bg-activity: #0a0a0a; --bg-sidebar: #121212; --bg-editor: #1a1a1a; --border: #2d2d2d; --accent: #6366f1; --text: #e2e8f0; --danger: #ef4444; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-editor); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        .activity-bar { width: 60px; background: var(--bg-activity); display: flex; flex-direction: column; align-items: center; padding: 20px 0; border-right: 1px solid var(--border); }
        .nav-icon { color: #555; font-size: 22px; margin-bottom: 30px; cursor: pointer; transition: 0.3s; }
        .nav-icon:hover { color: white; } .nav-icon.active { color: var(--accent); }
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .file-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .file-item { padding: 10px; margin-bottom: 4px; border-radius: 6px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 14px; }
        .file-item:hover { background: #1e1e1e; } .file-item.active { background: #252525; border-left: 3px solid var(--accent); }
        .main { flex-grow: 1; display: flex; flex-direction: column; }
        .content-area { padding: 60px; max-width: 800px; margin: 0 auto; width: 100%; overflow-y: auto; }
        #doc-title { font-size: 2.5rem; outline: none; margin-bottom: 20px; font-weight: 800; background: transparent; border: none; color: white; width: 100%; }
        #doc-body { font-size: 1.1rem; line-height: 1.8; color: #94a3b8; outline: none; min-height: 60vh; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: #1e1e1e; padding: 30px; border-radius: 12px; border: 1px solid var(--border); width: 350px; text-align: center; }
        .modal-btns { display: flex; gap: 10px; margin-top: 20px; }
        .m-btn { flex: 1; padding: 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; }
        .btn-cancel { background: #333; color: white; } .btn-confirm { background: var(--danger); color: white; }
    </style>
</head>
<body>

    <div class="activity-bar">
        <div class="nav-icon active"><i class="fas fa-file-alt"></i></div>
        <div class="nav-icon" onclick="logout()" style="margin-top: auto;"><i class="fas fa-door-open"></i></div>
    </div>

    <div class="sidebar">
        <div class="sidebar-header">
            <span>FILES</span>
            <i class="fas fa-plus-circle" style="cursor:pointer; color:var(--accent)" onclick="createNewFile()"></i>
        </div>
        <div class="file-list" id="file-list"></div>
    </div>

    <div class="main">
        <div class="content-area">
            <input id="doc-title" value="Loading..." oninput="syncData()">
            <div id="doc-body" contenteditable="true" oninput="syncData()"></div>
        </div>
    </div>

    <div class="modal-overlay" id="delete-modal">
        <div class="modal">
            <h3 style="color:white;">Delete File?</h3>
            <div class="modal-btns">
                <button class="m-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="m-btn btn-confirm" id="confirm-del-btn">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCk7IhBkZGyVOcxFgIbRNZoOXTMf8JG9yo",
            authDomain: "edupulse-vault.firebaseapp.com",
            databaseURL: "https://edupulse-vault-default-rtdb.firebaseio.com",
            projectId: "edupulse-vault",
            storageBucket: "edupulse-vault.firebasestorage.app",
            messagingSenderId: "771625601769",
            appId: "1:771625601769:web:5d007984668f3741ed3e78",
            measurementId: "G-CQ39T8546E"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const DB_PATH = "shared_vault_system/files"; 

        let files = [];
        let activeId = null;
        let deleteTargetId = null;

        function saveToCloud() { db.ref(DB_PATH).set(files); }

        db.ref(DB_PATH).on('value', (snapshot) => {
            const cloudData = snapshot.val();
            if (cloudData) {
                files = cloudData;
                renderFiles();
                if (!activeId && files.length > 0) openFile(files[0].id);
            } else {
                files = [{ id: Date.now(), title: "Welcome", body: "Start typing...", time: "Now" }];
                saveToCloud();
            }
        });

        function renderFiles() {
            const list = document.getElementById('file-list');
            list.innerHTML = '';
            files.forEach(file => {
                const div = document.createElement('div');
                div.className = `file-item ${activeId === file.id ? 'active' : ''}`;
                div.onclick = () => openFile(file.id);
                div.innerHTML = `<span>${file.title || 'Untitled'}</span> <i class="fas fa-trash" onclick="event.stopPropagation(); askDelete(${file.id})"></i>`;
                list.appendChild(div);
            });
        }

        function openFile(id) {
            activeId = id;
            const file = files.find(f => f.id === id);
            if (file) {
                document.getElementById('doc-title').value = file.title;
                document.getElementById('doc-body').innerHTML = file.body;
                renderFiles();
            }
        }

        function createNewFile() {
            const newFile = { id: Date.now(), title: "New Note", body: "...", time: "Now" };
            files.unshift(newFile);
            activeId = newFile.id;
            saveToCloud();
        }

        function syncData() {
            const file = files.find(f => f.id === activeId);
            if (file) {
                file.title = document.getElementById('doc-title').value;
                file.body = document.getElementById('doc-body').innerHTML;
                saveToCloud();
            }
        }

        function askDelete(id) { deleteTargetId = id; document.getElementById('delete-modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('delete-modal').style.display = 'none'; }
        
        document.getElementById('confirm-del-btn').onclick = function() {
            files = files.filter(f => f.id !== deleteTargetId);
            if (activeId === deleteTargetId) activeId = files.length > 0 ? files[0].id : null;
            saveToCloud();
            closeModal();
        };

        function logout() { sessionStorage.clear(); window.location.href = "ad1ash.html"; }
    </script>
</body>
</html>